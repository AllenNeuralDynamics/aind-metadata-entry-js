{
   "title": "EphysSession",
   "description": "Description of an ephys recording session",
   "type": "object",
   "properties": {
      "schema_version": {
         "title": "Version",
         "description": "schema version",
         "default": "0.2.0",
         "const": "0.2.0",
         "type": "string"
      },
      "describedBy": {
         "title": "Described by",
         "description": "The URL reference to the schema.",
         "default": "https://github.com/AllenNeuralDynamics/data_schema/blob/main/schemas/ephys/ephys_session.py",
         "const": "https://github.com/AllenNeuralDynamics/data_schema/blob/main/schemas/ephys/ephys_session.py",
         "type": "string"
      },
      "experimenter_full_name": {
         "title": "Experimenter full name",
         "description": "First and last name of the experimenter.",
         "type": "string"
      },
      "session_start_time": {
         "title": "Session start time",
         "type": "string",
         "format": "date-time"
      },
      "session_end_time": {
         "title": "Session end time",
         "type": "string",
         "format": "date-time"
      },
      "subject_id": {
         "title": "Subject ID",
         "type": "integer"
      },
      "session_type": {
         "title": "Session type",
         "allOf": [
            {
               "$ref": "#/definitions/SessionType"
            }
         ]
      },
      "stimulus_protocol_id": {
         "title": "Stimulus protocol ID",
         "type": "string"
      },
      "rig_id": {
         "title": "Rig ID",
         "type": "string"
      },
      "expected_data_streams": {
         "type": "array",
         "items": {
            "$ref": "#/definitions/ExpectedDataStream"
         }
      },
      "probe_streams": {
         "title": "Probe streams",
         "uniqueItems": true,
         "type": "array",
         "items": {
            "$ref": "#/definitions/Stream"
         }
      },
      "ccf_version": {
         "title": "CCF version",
         "allOf": [
            {
               "$ref": "#/definitions/CcfVersion"
            }
         ]
      },
      "coordinate_transform": {
         "title": "Coordinate transform",
         "description": "Path to file that details the coordinate transform.",
         "type": "string"
      },
      "notes": {
         "title": "Notes",
         "type": "string"
      }
   },
   "required": [
      "experimenter_full_name",
      "session_start_time",
      "session_end_time",
      "subject_id",
      "session_type",
      "rig_id",
      "probe_streams",
      "ccf_version"
   ],
   "definitions": {
      "SessionType": {
         "title": "SessionType",
         "description": "Session type name",
         "enum": [
            "Test",
            "Foraging A",
            "Spontaneous",
            "Foraging B"
         ]
      },
      "ExpectedDataStream": {
         "title": "ExpectedDataStream",
         "description": "Names of data streams to expect in recording",
         "enum": [
            "Neuropixels probes",
            "Body camera",
            "Face camera",
            "Eye camera",
            "Bonsai file",
            "Harp bin file",
            "Other"
         ]
      },
      "CcfCoords": {
         "title": "CcfCoords",
         "description": "Coordinates in CCF template space",
         "type": "object",
         "properties": {
            "ML": {
               "title": "ML (um)",
               "units": "um",
               "type": "number"
            },
            "AP": {
               "title": "AP (um)",
               "units": "um",
               "type": "number"
            },
            "DV": {
               "title": "DV (um)",
               "units": "um",
               "type": "number"
            }
         },
         "required": [
            "ML",
            "AP",
            "DV"
         ]
      },
      "Field3dCoordinatesMm": {
         "title": "Field3dCoordinatesMm",
         "description": "Description of 3d coordinates in mm",
         "type": "object",
         "properties": {
            "X": {
               "title": "X (mm)",
               "units": "mm",
               "type": "number"
            },
            "Y": {
               "title": "Y (mm)",
               "units": "mm",
               "type": "number"
            },
            "Z": {
               "title": "Z (mm)",
               "units": "mm",
               "type": "number"
            }
         },
         "required": [
            "X",
            "Y",
            "Z"
         ]
      },
      "AngleName": {
         "title": "AngleName",
         "description": "Euler angle name",
         "enum": [
            "XY",
            "XZ",
            "YZ"
         ]
      },
      "ManipulatorAngles": {
         "title": "ManipulatorAngles",
         "description": "Description of manipulator angle",
         "type": "object",
         "properties": {
            "name": {
               "title": "AngleName",
               "allOf": [
                  {
                     "$ref": "#/definitions/AngleName"
                  }
               ]
            },
            "value": {
               "title": "Value (deg)",
               "units": "deg",
               "type": "number"
            }
         },
         "required": [
            "name",
            "value"
         ]
      },
      "EphysProbe": {
         "title": "EphysProbe",
         "description": "Description of an ephys probe",
         "type": "object",
         "properties": {
            "name": {
               "title": "Name",
               "type": "string"
            },
            "tip_targeted_structure": {
               "title": "Tip Targeted Structure",
               "type": "string"
            },
            "other_targeted_structures": {
               "title": "Other Targeted Structures",
               "type": "string"
            },
            "targeted_ccf_coordinates": {
               "title": "Targeted CCF coordinates",
               "allOf": [
                  {
                     "$ref": "#/definitions/CcfCoords"
                  }
               ]
            },
            "targeted_lab_coordinates": {
               "title": "Targeted lab coordinates",
               "description": "Targeted coordinates relative to the headframe",
               "allOf": [
                  {
                     "$ref": "#/definitions/Field3dCoordinatesMm"
                  }
               ]
            },
            "manipulator_coordinates": {
               "title": "Manipulator coordinates",
               "allOf": [
                  {
                     "$ref": "#/definitions/Field3dCoordinatesMm"
                  }
               ]
            },
            "manipulator_angles": {
               "title": "Manipulator angles",
               "uniqueItems": true,
               "type": "array",
               "items": {
                  "$ref": "#/definitions/ManipulatorAngles"
               }
            }
         },
         "required": [
            "name",
            "tip_targeted_structure",
            "targeted_ccf_coordinates",
            "targeted_lab_coordinates",
            "manipulator_coordinates",
            "manipulator_angles"
         ]
      },
      "Laser": {
         "title": "Laser",
         "description": "Description of a laser",
         "type": "object",
         "properties": {
            "name": {
               "title": "Name",
               "type": "string"
            },
            "wavelength": {
               "title": "Wavelength (nm)",
               "units": "nm",
               "type": "integer"
            },
            "power": {
               "title": "Power (mW)",
               "units": "mW",
               "type": "number"
            },
            "targeted_structure": {
               "title": "Targeted structure",
               "type": "string"
            },
            "targeted_ccf_coordinates": {
               "title": "Targeted CCF coordinates",
               "allOf": [
                  {
                     "$ref": "#/definitions/CcfCoords"
                  }
               ]
            },
            "targeted_lab_coordinates": {
               "title": "Targeted lab coordinates",
               "description": "Targeted coordinates relative to the headframe",
               "allOf": [
                  {
                     "$ref": "#/definitions/Field3dCoordinatesMm"
                  }
               ]
            },
            "manipulator_coordinates": {
               "title": "Manipulator coordinates",
               "allOf": [
                  {
                     "$ref": "#/definitions/Field3dCoordinatesMm"
                  }
               ]
            },
            "manipulator_angles": {
               "title": "Manipulator angles",
               "uniqueItems": true,
               "type": "array",
               "items": {
                  "$ref": "#/definitions/ManipulatorAngles"
               }
            }
         },
         "required": [
            "name",
            "wavelength",
            "power",
            "targeted_structure",
            "targeted_ccf_coordinates",
            "targeted_lab_coordinates",
            "manipulator_coordinates",
            "manipulator_angles"
         ]
      },
      "Stream": {
         "title": "Stream",
         "description": "Stream of data with a start and stop time",
         "type": "object",
         "properties": {
            "stream_start_time": {
               "title": "Stream start time",
               "type": "string",
               "format": "date-time"
            },
            "stream_stop_time": {
               "title": "Stream stop time",
               "type": "string",
               "format": "date-time"
            },
            "probes": {
               "title": "Probes",
               "uniqueItems": true,
               "type": "array",
               "items": {
                  "$ref": "#/definitions/EphysProbe"
               }
            },
            "lasers": {
               "title": "Lasers",
               "uniqueItems": true,
               "type": "array",
               "items": {
                  "$ref": "#/definitions/Laser"
               }
            }
         },
         "required": [
            "stream_start_time",
            "stream_stop_time",
            "probes",
            "lasers"
         ]
      },
      "CcfVersion": {
         "title": "CcfVersion",
         "description": "CCF version",
         "enum": [
            "CCFv3"
         ]
      }
   }
}
